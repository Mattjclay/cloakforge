(()=>{console.log("CloakForge - Privacy \u2022 Security \u2022 Freedom");var d=[],u,i,c,o,l,f;document.addEventListener("DOMContentLoaded",function(){let e=document.getElementById("search-input"),t=document.querySelector(".search-filters"),s=document.querySelector(".search-container"),r=document.getElementById("search-btn");u=document.getElementById("search-input"),i=document.getElementById("search-results"),c=document.getElementById("category-filter"),o=document.getElementById("tag-filter"),l=document.getElementById("section-filter"),f=document.getElementById("clear-filters"),e.addEventListener("focus",function(){t&&(t.classList.add("show"),s.classList.add("filters-active"))}),document.addEventListener("click",function(a){!(a.target.closest(".search-container")||a.target.closest(".search-filters"))&&t&&(e.value.trim()||(t.classList.remove("show"),s.classList.remove("filters-active")))}),u&&i&&(fetch("/index.json").then(a=>{if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);return a.json()}).then(a=>{d=a,console.log("Search index loaded:",d.length,"items"),populateFilters()}).catch(a=>(console.error("Error loading search index:",a),fetch("./index.json").then(n=>{if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);return n.json()}).then(n=>{d=n,console.log("Search index loaded (alternative path):",d.length,"items"),populateFilters()}).catch(n=>{console.error("Error loading search index from alternative path:",n),i.innerHTML='<div class="alert alert-warning">Search functionality is currently unavailable. Please try again later.</div>'}))),u.addEventListener("input",h),u.addEventListener("focus",M),c&&c.addEventListener("change",h),o&&o.addEventListener("change",h),l&&l.addEventListener("change",h),f&&f.addEventListener("click",A),document.addEventListener("click",function(a){!u.contains(a.target)&&!i.contains(a.target)&&g()}),u.addEventListener("keydown",j))});function h(e){let t=u.value.trim().toLowerCase(),s=c?c.value:"",r=o?o.value:"",a=l?l.value:"";if($(),t.length>=2||s||r||a){let n=E(t,s,r,a);L(n,t)}else g()}function M(){let e=u.value.trim().toLowerCase(),t=c?c.value:"",s=o?o.value:"",r=l?l.value:"";if(e.length>=2||t||s||r){let a=E(e,t,s,r);L(a,e)}}function E(e,t,s,r){return d.filter(a=>{let n=!0;if(e.length>=2){let w=a.title.toLowerCase().includes(e),C=a.content.toLowerCase().includes(e),k=a.summary.toLowerCase().includes(e),S=a.tags&&a.tags.some(F=>F.toLowerCase().includes(e)),x=a.categories&&a.categories.toLowerCase().includes(e);n=w||C||k||S||x}let v=!0;t&&(v=a.categories===t);let m=!0;s&&(m=a.tags&&a.tags.includes(s));let p=!0;return r&&(p=a.section===r),n&&v&&m&&p}).slice(0,12)}function L(e,t){let s=b(),r=s.length>0?`<div class="search-filter-summary">Filtered by: ${s.join(", ")}</div>`:"";if(e.length===0){let a=t?`No results found for "${t}"`:"No results match the selected filters";i.innerHTML=`
            ${r}
            <div class="search-no-results">
                ${a}
            </div>
        `}else{let a=e.length===1?"result":"results";i.innerHTML=`
            ${r}
            <div class="search-results-count">${e.length} ${a} found</div>
            ${e.map(n=>`
                <div class="search-result-item" onclick="window.location.href='${n.href}'">
                    <div class="search-result-title">${y(n.title,t)}</div>
                    <div class="search-result-summary">${y(B(n.summary,120),t)}</div>
                    <div class="search-result-meta">
                        <span class="search-result-section">${n.section}</span>
                        ${n.categories?`<span class="text-muted">${n.categories}</span>`:""}
                        ${n.tags?n.tags.slice(0,3).map(v=>`<span class="search-tag">#${v}</span>`).join(""):""}
                    </div>
                </div>
            `).join("")}
        `}I()}function b(){let e=[];return c&&c.value&&e.push(`Category: ${c.value}`),o&&o.value&&e.push(`Tag: #${o.value}`),l&&l.value&&e.push(`Section: ${l.value}`),e}function $(){if(f){let e=c&&c.value||o&&o.value||l&&l.value;f.disabled=!e,[c,o,l].forEach(t=>{t&&(t.value?t.classList.add("filter-active"):t.classList.remove("filter-active"))})}}function A(){c&&(c.value=""),o&&(o.value=""),l&&(l.value=""),$(),h()}function y(e,t){if(!e||!t)return e;let s=new RegExp(`(${T(t)})`,"gi");return e.replace(s,'<mark style="background-color: var(--accent-tertiary); color: var(--text-primary); padding: 0 2px; border-radius: 2px;">$1</mark>')}function B(e,t){return!e||e.length<=t?e:e.substring(0,t).trim()+"..."}function T(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function I(){i.style.display="block"}function g(){i.style.display="none"}function j(e){let t=i.querySelectorAll(".search-result-item"),s=i.querySelector(".search-result-item.active"),r=-1;switch(s&&(r=Array.from(t).indexOf(s)),e.key){case"ArrowDown":e.preventDefault(),r<t.length-1&&(s&&s.classList.remove("active"),t[r+1].classList.add("active"));break;case"ArrowUp":e.preventDefault(),r>0&&(s&&s.classList.remove("active"),t[r-1].classList.add("active"));break;case"Enter":e.preventDefault(),s&&s.click();break;case"Escape":g(),u.blur();break}}})();
