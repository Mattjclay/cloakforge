(()=>{console.log("CloakForge - Privacy \u2022 Security \u2022 Freedom");var h=[],u,l,c,o,i,g,p=new Set,w=new Set;document.addEventListener("DOMContentLoaded",function(){H();let e=document.getElementById("search-input"),t=document.querySelector(".search-filters"),r=document.querySelector(".search-container"),n=document.getElementById("search-btn");u=document.getElementById("search-input"),l=document.getElementById("search-results"),c=document.getElementById("category-filter"),o=document.getElementById("tag-filter"),i=document.getElementById("section-filter"),g=document.getElementById("clear-filters"),e.addEventListener("focus",function(){t&&(t.classList.add("show"),r.classList.add("filters-active"))}),document.addEventListener("click",function(a){!(a.target.closest(".search-container")||a.target.closest(".search-filters"))&&t&&(e.value.trim()||(t.classList.remove("show"),r.classList.remove("filters-active")))}),u&&l&&(fetch("/index.json").then(a=>{if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);return a.json()}).then(a=>{h=a,console.log("Search index loaded:",h.length,"items"),S()}).catch(a=>(console.error("Error loading search index:",a),fetch("./index.json").then(s=>{if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);return s.json()}).then(s=>{h=s,console.log("Search index loaded (alternative path):",h.length,"items"),S()}).catch(s=>{console.error("Error loading search index from alternative path:",s),l.innerHTML='<div class="alert alert-warning">Search functionality is currently unavailable. Please try again later.</div>'}))),u.addEventListener("input",f),u.addEventListener("focus",I),c&&c.addEventListener("change",f),o&&o.addEventListener("change",f),i&&i.addEventListener("change",f),g&&g.addEventListener("click",F),document.addEventListener("click",function(a){!u.contains(a.target)&&!l.contains(a.target)&&k()}),u.addEventListener("keydown",j))});function S(){h.forEach(e=>{e.categories&&Array.isArray(e.categories)?e.categories.forEach(t=>{t&&t.trim()&&p.add(t)}):e.categories&&typeof e.categories=="string"&&e.categories.trim()&&p.add(e.categories),e.tags&&Array.isArray(e.tags)&&e.tags.forEach(t=>{t&&t.trim()&&w.add(t)})}),c&&Array.from(p).sort().forEach(e=>{let t=document.createElement("option");t.value=e,t.textContent=e,c.appendChild(t)}),o&&Array.from(w).sort().forEach(e=>{let t=document.createElement("option");t.value=e,t.textContent=`#${e}`,o.appendChild(t)}),y()}function f(e){let t=u.value.trim().toLowerCase(),r=c?c.value:"",n=o?o.value:"",a=i?i.value:"";if(y(),t.length>=2||r||n||a){let s=x(t,r,n,a);A(s,t)}else k()}function I(){let e=u.value.trim().toLowerCase(),t=c?c.value:"",r=o?o.value:"",n=i?i.value:"";if(e.length>=2||t||r||n){let a=x(e,t,r,n);A(a,e)}}function x(e,t,r,n){return h.filter(a=>{let s=!0;if(e.length>=2){let b=a.title.toLowerCase().includes(e),T=a.content.toLowerCase().includes(e),M=a.summary.toLowerCase().includes(e),B=a.tags&&a.tags.some(m=>m.toLowerCase().includes(e)),v=!1;Array.isArray(a.categories)?v=a.categories.some(m=>m.toLowerCase().includes(e)):typeof a.categories=="string"&&(v=a.categories.toLowerCase().includes(e)),s=b||T||M||B||v}let d=!0;t&&(Array.isArray(a.categories)?d=a.categories.includes(t):typeof a.categories=="string"?d=a.categories===t:d=!1);let E=!0;r&&(E=a.tags&&a.tags.includes(r));let L=!0;return n&&(L=a.section===n),s&&d&&E&&L}).slice(0,12)}function A(e,t){let r=D(),n=r.length>0?`<div class="search-filter-summary">Filtered by: ${r.join(", ")}</div>`:"";if(e.length===0){let a=t?`No results found for "${t}"`:"No results match the selected filters";l.innerHTML=`
            ${n}
            <div class="search-no-results">
                ${a}
            </div>
        `}else{let a=e.length===1?"result":"results";l.innerHTML=`
            ${n}
            <div class="search-results-count">${e.length} ${a} found</div>
            ${e.map(s=>`
                <div class="search-result-item" onclick="window.location.href='${s.href}'">
                    <div class="search-result-title">${C(s.title,t)}</div>
                    <div class="search-result-summary">${C(V(s.summary,120),t)}</div>
                    <div class="search-result-meta">
                        <span class="search-result-section">${s.section}</span>
                        ${s.categories?`<span class="text-muted">${s.categories}</span>`:""}
                        ${s.tags?s.tags.slice(0,3).map(d=>`<span class="search-tag">#${d}</span>`).join(""):""}
                    </div>
                </div>
            `).join("")}
        `}R()}function D(){let e=[];return c&&c.value&&e.push(`Category: ${c.value}`),o&&o.value&&e.push(`Tag: #${o.value}`),i&&i.value&&e.push(`Section: ${i.value}`),e}function y(){if(g){let e=c&&c.value||o&&o.value||i&&i.value;g.disabled=!e,[c,o,i].forEach(t=>{t&&(t.value?t.classList.add("filter-active"):t.classList.remove("filter-active"))})}}function F(){c&&(c.value=""),o&&(o.value=""),i&&(i.value=""),y(),f()}function C(e,t){if(!e||!t)return e;let r=new RegExp(`(${O(t)})`,"gi");return e.replace(r,'<mark style="background-color: var(--accent-tertiary); color: var(--text-primary); padding: 0 2px; border-radius: 2px;">$1</mark>')}function V(e,t){return!e||e.length<=t?e:e.substring(0,t).trim()+"..."}function O(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function R(){l.style.display="block"}function k(){l.style.display="none"}function j(e){let t=l.querySelectorAll(".search-result-item"),r=l.querySelector(".search-result-item.active"),n=-1;switch(r&&(n=Array.from(t).indexOf(r)),e.key){case"ArrowDown":e.preventDefault(),n<t.length-1&&(r&&r.classList.remove("active"),t[n+1].classList.add("active"));break;case"ArrowUp":e.preventDefault(),n>0&&(r&&r.classList.remove("active"),t[n-1].classList.add("active"));break;case"Enter":e.preventDefault(),r&&r.click();break;case"Escape":k(),u.blur();break}}function H(){let e=localStorage.getItem("cloakforge-theme")||"vscode-dark";$(e);let t=document.querySelectorAll(".theme-option");t.forEach(r=>{r.addEventListener("click",function(n){n.preventDefault();let a=this.getAttribute("data-theme");$(a),t.forEach(s=>s.classList.remove("active")),this.classList.add("active"),localStorage.setItem("cloakforge-theme",a)})})}function $(e){document.documentElement.setAttribute("data-theme",e);let t=document.getElementById("current-theme"),r={light:"VS Code Light","vscode-dark":"VS Code Dark","cloakforge-blue":"CloakForge Blue",cyberpunk:"Cyberpunk",matrix:"Matrix",hacker:"Hacker","red-alert":"Red Alert",dracula:"Dracula",monokai:"Monokai","solarized-dark":"Solarized Dark","one-dark":"One Dark","github-dark":"GitHub Dark","gruvbox-dark":"Gruvbox Dark",nord:"Nord",catppuccin:"Catppuccin","tokyo-night":"Tokyo Night","oceanic-next":"Oceanic Next"};t&&(t.textContent=r[e]||"VS Code Dark"),document.querySelectorAll(".theme-option").forEach(a=>{a.getAttribute("data-theme")===e?a.classList.add("active"):a.classList.remove("active")}),console.log(`Theme switched to: ${r[e]||e}`)}})();
