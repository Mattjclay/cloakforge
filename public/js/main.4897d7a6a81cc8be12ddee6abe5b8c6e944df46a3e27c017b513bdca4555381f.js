(()=>{console.log("CloakForge - Privacy \u2022 Security \u2022 Freedom");var g=[],h,u,c,l,f,k,E=new Set,I=new Set;document.addEventListener("DOMContentLoaded",function(){z(),H();let e=document.getElementById("search-input"),t=document.querySelector(".search-filters"),a=document.querySelector(".search-container"),o=document.getElementById("search-btn");h=document.getElementById("search-input"),u=document.getElementById("search-results"),c=document.getElementById("category-filter"),l=document.getElementById("tag-filter"),f=document.getElementById("section-filter"),k=document.getElementById("clear-filters"),e.addEventListener("focus",function(){t&&(t.classList.add("show"),a.classList.add("filters-active"))}),document.addEventListener("click",function(n){!(n.target.closest(".search-container")||n.target.closest(".search-filters"))&&t&&(e.value.trim()||(t.classList.remove("show"),a.classList.remove("filters-active")))}),h&&u&&(fetch("/index.json").then(n=>{if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);return n.json()}).then(n=>{g=n,console.log("Search index loaded:",g.length,"items"),C()}).catch(n=>(console.error("Error loading search index:",n),fetch("./index.json").then(s=>{if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);return s.json()}).then(s=>{g=s,console.log("Search index loaded (alternative path):",g.length,"items"),C()}).catch(s=>{console.error("Error loading search index from alternative path:",s),u.innerHTML='<div class="alert alert-warning">Search functionality is currently unavailable. Please try again later.</div>'}))),h.addEventListener("input",S),h.addEventListener("focus",D),c&&c.addEventListener("change",S),l&&l.addEventListener("change",S),f&&f.addEventListener("change",S),k&&k.addEventListener("click",U),document.addEventListener("click",function(n){!h.contains(n.target)&&!u.contains(n.target)&&F()}),h.addEventListener("keydown",V))});function C(){g.forEach(e=>{e.categories&&Array.isArray(e.categories)?e.categories.forEach(t=>{t&&t.trim()&&E.add(t)}):e.categories&&typeof e.categories=="string"&&e.categories.trim()&&E.add(e.categories),e.tags&&Array.isArray(e.tags)&&e.tags.forEach(t=>{t&&t.trim()&&I.add(t)})}),c&&Array.from(E).sort().forEach(e=>{let t=document.createElement("option");t.value=e,t.textContent=e,c.appendChild(t)}),l&&Array.from(I).sort().forEach(e=>{let t=document.createElement("option");t.value=e,t.textContent=`#${e}`,l.appendChild(t)}),L()}function S(e){let t=h.value.trim().toLowerCase(),a=c?c.value:"",o=l?l.value:"",n=f?f.value:"";if(L(),t.length>=2||a||o||n){let s=R(t,a,o,n);T(s,t)}else F()}function D(){let e=h.value.trim().toLowerCase(),t=c?c.value:"",a=l?l.value:"",o=f?f.value:"";if(e.length>=2||t||a||o){let n=R(e,t,a,o);T(n,e)}}function y(e,t,a=.6){if(!e||!t)return{matches:!1,score:0};if(e=e.toLowerCase(),t=t.toLowerCase(),t.includes(e))return{matches:!0,score:1};let o=x(e,t),n=Math.max(e.length,t.length),s=1-o/n,i=t.split(/\s+/),r=0;for(let m of i){m.startsWith(e)&&(r=Math.max(r,.8));let M=1-x(e,m)/Math.max(e.length,m.length);r=Math.max(r,M)}i.map(m=>m.charAt(0)).join("").includes(e)&&(r=Math.max(r,.7));let p=Math.max(s,r);return{matches:p>=a,score:p}}function x(e,t){let a=[];for(let o=0;o<=t.length;o++)a[o]=[o];for(let o=0;o<=e.length;o++)a[0][o]=o;for(let o=1;o<=t.length;o++)for(let n=1;n<=e.length;n++)t.charAt(o-1)===e.charAt(n-1)?a[o][n]=a[o-1][n-1]:a[o][n]=Math.min(a[o-1][n-1]+1,a[o][n-1]+1,a[o-1][n]+1);return a[t.length][e.length]}function R(e,t,a,o){let n=g.filter(s=>{let i=!0;t&&(Array.isArray(s.categories)?i=s.categories.includes(t):typeof s.categories=="string"?i=s.categories===t:i=!1);let r=!0;a&&(r=s.tags&&s.tags.includes(a));let d=!0;return o&&(d=s.section===o),i&&r&&d});return e.length>=2?n.map(i=>{let r=0,d="",p=y(e,i.title,.4);p.matches&&(r=Math.max(r,p.score*1),d="title");let m=y(e,i.summary||"",.5);m.matches&&(r=Math.max(r,m.score*.8),d||(d="summary"));let b=y(e,i.content||"",.6);if(b.matches&&(r=Math.max(r,b.score*.6),d||(d="content")),i.tags)for(let w of i.tags){let v=y(e,w,.4);v.matches&&(r=Math.max(r,v.score*.9),d||(d="tag"))}let M=Array.isArray(i.categories)?i.categories:[i.categories];for(let w of M)if(w){let v=y(e,w,.4);v.matches&&(r=Math.max(r,v.score*.7),d||(d="category"))}return{...i,searchScore:r,matchType:d}}).filter(i=>i.searchScore>0).sort((i,r)=>r.searchScore-i.searchScore).slice(0,12):n.slice(0,12)}function T(e,t){let a=O(),o=a.length>0?`<div class="search-filter-summary">Filtered by: ${a.join(", ")}</div>`:"";if(e.length===0){let n=t?`No results found for "${t}"`:"No results match the selected filters";u.innerHTML=`
            ${o}
            <div class="search-no-results">
                ${n}
            </div>
        `}else{let n=e.length===1?"result":"results";u.innerHTML=`
            ${o}
            <div class="search-results-count">${e.length} ${n} found</div>
            ${e.map(s=>`
                <div class="search-result-item" onclick="window.location.href='${s.href}'">
                    <div class="search-result-title">${B(s.title,t)}</div>
                    <div class="search-result-summary">${B(P(s.summary,120),t)}</div>
                    <div class="search-result-meta">
                        <span class="search-result-section">${s.section}</span>
                        ${s.categories?`<span class="text-muted">${s.categories}</span>`:""}
                        ${s.tags?s.tags.slice(0,3).map(i=>`<span class="search-tag">#${i}</span>`).join(""):""}
                    </div>
                </div>
            `).join("")}
        `}j()}function O(){let e=[];return c&&c.value&&e.push(`Category: ${c.value}`),l&&l.value&&e.push(`Tag: #${l.value}`),f&&f.value&&e.push(`Section: ${f.value}`),e}function L(){if(k){let e=c&&c.value||l&&l.value||f&&f.value;k.disabled=!e,[c,l,f].forEach(t=>{t&&(t.value?t.classList.add("filter-active"):t.classList.remove("filter-active"))})}}function U(){c&&(c.value=""),l&&(l.value=""),f&&(f.value=""),L(),S()}function B(e,t){if(!e||!t)return e;let a=new RegExp(`(${N(t)})`,"gi");return e.replace(a,'<mark style="background-color: var(--accent-tertiary); color: var(--text-primary); padding: 0 2px; border-radius: 2px;">$1</mark>')}function P(e,t){return!e||e.length<=t?e:e.substring(0,t).trim()+"..."}function N(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function j(){u.style.display="block"}function F(){u.style.display="none"}function V(e){let t=u.querySelectorAll(".search-result-item"),a=u.querySelector(".search-result-item.active"),o=-1;switch(a&&(o=Array.from(t).indexOf(a)),e.key){case"ArrowDown":e.preventDefault(),o<t.length-1&&(a&&a.classList.remove("active"),t[o+1].classList.add("active"));break;case"ArrowUp":e.preventDefault(),o>0&&(a&&a.classList.remove("active"),t[o-1].classList.add("active"));break;case"Enter":e.preventDefault(),a&&a.click();break;case"Escape":F(),h.blur();break}}function z(){let e=localStorage.getItem("cloakforge-theme")||"vscode-dark";A(e);let t=document.querySelectorAll(".theme-option");t.forEach(a=>{a.addEventListener("click",function(o){o.preventDefault();let n=this.getAttribute("data-theme");A(n),t.forEach(s=>s.classList.remove("active")),this.classList.add("active"),localStorage.setItem("cloakforge-theme",n)})})}function A(e){document.documentElement.setAttribute("data-theme",e);let t=document.getElementById("current-theme"),a={light:"VS Code Light","vscode-dark":"VS Code Dark","cloakforge-blue":"CloakForge Blue",cyberpunk:"Cyberpunk",matrix:"Matrix",hacker:"Hacker","red-alert":"Red Alert",dracula:"Dracula",monokai:"Monokai","solarized-dark":"Solarized Dark","one-dark":"One Dark","github-dark":"GitHub Dark","gruvbox-dark":"Gruvbox Dark",nord:"Nord",catppuccin:"Catppuccin","tokyo-night":"Tokyo Night","oceanic-next":"Oceanic Next"};t&&(t.textContent=a[e]||"VS Code Dark"),document.querySelectorAll(".theme-option").forEach(n=>{n.getAttribute("data-theme")===e?n.classList.add("active"):n.classList.remove("active")}),console.log(`Theme switched to: ${a[e]||e}`)}function H(){let e=localStorage.getItem("selectedFont")||"Inter";$(e),document.addEventListener("click",function(t){if(t.target.closest(".font-option")){t.preventDefault();let o=t.target.closest(".font-option").getAttribute("data-font");console.log("Font option clicked:",o),$(o),localStorage.setItem("selectedFont",o)}}),console.log("Font switcher initialized with font:",e)}function $(e){let t={Inter:'"Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',Roboto:'"Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif',"Open Sans":'"Open Sans", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',Lato:'"Lato", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',Montserrat:'"Montserrat", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',Poppins:'"Poppins", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',"Source Sans Pro":'"Source Sans Pro", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',Nunito:'"Nunito", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',Raleway:'"Raleway", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',Ubuntu:'"Ubuntu", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',"Fira Sans":'"Fira Sans", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',"JetBrains Mono":'"JetBrains Mono", "Fira Code", "Cascadia Code", Consolas, monospace'},a=document.getElementById("font-override");a&&a.remove();let o=t[e]||t.Inter,n=document.createElement("style");n.id="font-override",n.textContent=`
        body, html, .container, .content, p, h1, h2, h3, h4, h5, h6, 
        .navbar, .nav-link, .btn, .card, .card-body, .card-title, 
        .hero-section, .search-container, .app-card, .section-title,
        .dropdown-item, .theme-option, .font-option, div, span, a {
            font-family: ${o} !important;
        }
        
        /* Preserve individual font previews in dropdown */
        .font-preview[style*="Inter"] { font-family: "Inter", sans-serif !important; }
        .font-preview[style*="Roboto"] { font-family: "Roboto", sans-serif !important; }
        .font-preview[style*="Open Sans"] { font-family: "Open Sans", sans-serif !important; }
        .font-preview[style*="Lato"] { font-family: "Lato", sans-serif !important; }
        .font-preview[style*="Montserrat"] { font-family: "Montserrat", sans-serif !important; }
        .font-preview[style*="Poppins"] { font-family: "Poppins", sans-serif !important; }
        .font-preview[style*="Source Sans Pro"] { font-family: "Source Sans Pro", sans-serif !important; }
        .font-preview[style*="Nunito"] { font-family: "Nunito", sans-serif !important; }
        .font-preview[style*="Raleway"] { font-family: "Raleway", sans-serif !important; }
        .font-preview[style*="Ubuntu"] { font-family: "Ubuntu", sans-serif !important; }
        .font-preview[style*="Fira Sans"] { font-family: "Fira Sans", sans-serif !important; }
        .font-preview[style*="JetBrains Mono"] { font-family: "JetBrains Mono", monospace !important; }
        
        /* Preserve monospace for code elements */
        code, pre, .code, .highlight {
            font-family: ${e==="JetBrains Mono"?o:'"JetBrains Mono", "Fira Code", "Cascadia Code", Consolas, monospace'} !important;
        }
    `,document.head.appendChild(n);let s=document.getElementById("current-font");s&&(s.textContent=e),document.querySelectorAll(".font-option").forEach(r=>{r.getAttribute("data-font")===e?r.classList.add("active"):r.classList.remove("active")}),console.log(`Font switched to: ${e}`)}})();
