(()=>{console.log("CloakForge - Privacy \u2022 Security \u2022 Freedom");var d=[],u,i,c,o,l,f,E=new Set,L=new Set;document.addEventListener("DOMContentLoaded",function(){let e=document.getElementById("search-input"),t=document.querySelector(".search-filters"),s=document.querySelector(".search-container"),r=document.getElementById("search-btn");u=document.getElementById("search-input"),i=document.getElementById("search-results"),c=document.getElementById("category-filter"),o=document.getElementById("tag-filter"),l=document.getElementById("section-filter"),f=document.getElementById("clear-filters"),e.addEventListener("focus",function(){t&&(t.classList.add("show"),s.classList.add("filters-active"))}),document.addEventListener("click",function(a){!(a.target.closest(".search-container")||a.target.closest(".search-filters"))&&t&&(e.value.trim()||(t.classList.remove("show"),s.classList.remove("filters-active")))}),u&&i&&(fetch("/index.json").then(a=>{if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);return a.json()}).then(a=>{d=a,console.log("Search index loaded:",d.length,"items"),$()}).catch(a=>(console.error("Error loading search index:",a),fetch("./index.json").then(n=>{if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);return n.json()}).then(n=>{d=n,console.log("Search index loaded (alternative path):",d.length,"items"),$()}).catch(n=>{console.error("Error loading search index from alternative path:",n),i.innerHTML='<div class="alert alert-warning">Search functionality is currently unavailable. Please try again later.</div>'}))),u.addEventListener("input",h),u.addEventListener("focus",F),c&&c.addEventListener("change",h),o&&o.addEventListener("change",h),l&&l.addEventListener("change",h),f&&f.addEventListener("click",I),document.addEventListener("click",function(a){!u.contains(a.target)&&!i.contains(a.target)&&m()}),u.addEventListener("keydown",D))});function $(){d.forEach(e=>{e.categories&&E.add(e.categories),e.tags&&Array.isArray(e.tags)&&e.tags.forEach(t=>L.add(t))}),c&&Array.from(E).sort().forEach(e=>{let t=document.createElement("option");t.value=e,t.textContent=e,c.appendChild(t)}),o&&Array.from(L).sort().forEach(e=>{let t=document.createElement("option");t.value=e,t.textContent=`#${e}`,o.appendChild(t)}),g()}function h(e){let t=u.value.trim().toLowerCase(),s=c?c.value:"",r=o?o.value:"",a=l?l.value:"";if(g(),t.length>=2||s||r||a){let n=C(t,s,r,a);k(n,t)}else m()}function F(){let e=u.value.trim().toLowerCase(),t=c?c.value:"",s=o?o.value:"",r=l?l.value:"";if(e.length>=2||t||s||r){let a=C(e,t,s,r);k(a,e)}}function C(e,t,s,r){return d.filter(a=>{let n=!0;if(e.length>=2){let S=a.title.toLowerCase().includes(e),x=a.content.toLowerCase().includes(e),M=a.summary.toLowerCase().includes(e),b=a.tags&&a.tags.some(B=>B.toLowerCase().includes(e)),A=a.categories&&a.categories.toLowerCase().includes(e);n=S||x||M||b||A}let v=!0;t&&(v=a.categories===t);let p=!0;s&&(p=a.tags&&a.tags.includes(s));let y=!0;return r&&(y=a.section===r),n&&v&&p&&y}).slice(0,12)}function k(e,t){let s=T(),r=s.length>0?`<div class="search-filter-summary">Filtered by: ${s.join(", ")}</div>`:"";if(e.length===0){let a=t?`No results found for "${t}"`:"No results match the selected filters";i.innerHTML=`
            ${r}
            <div class="search-no-results">
                ${a}
            </div>
        `}else{let a=e.length===1?"result":"results";i.innerHTML=`
            ${r}
            <div class="search-results-count">${e.length} ${a} found</div>
            ${e.map(n=>`
                <div class="search-result-item" onclick="window.location.href='${n.href}'">
                    <div class="search-result-title">${w(n.title,t)}</div>
                    <div class="search-result-summary">${w(j(n.summary,120),t)}</div>
                    <div class="search-result-meta">
                        <span class="search-result-section">${n.section}</span>
                        ${n.categories?`<span class="text-muted">${n.categories}</span>`:""}
                        ${n.tags?n.tags.slice(0,3).map(v=>`<span class="search-tag">#${v}</span>`).join(""):""}
                    </div>
                </div>
            `).join("")}
        `}V()}function T(){let e=[];return c&&c.value&&e.push(`Category: ${c.value}`),o&&o.value&&e.push(`Tag: #${o.value}`),l&&l.value&&e.push(`Section: ${l.value}`),e}function g(){if(f){let e=c&&c.value||o&&o.value||l&&l.value;f.disabled=!e,[c,o,l].forEach(t=>{t&&(t.value?t.classList.add("filter-active"):t.classList.remove("filter-active"))})}}function I(){c&&(c.value=""),o&&(o.value=""),l&&(l.value=""),g(),h()}function w(e,t){if(!e||!t)return e;let s=new RegExp(`(${R(t)})`,"gi");return e.replace(s,'<mark style="background-color: var(--accent-tertiary); color: var(--text-primary); padding: 0 2px; border-radius: 2px;">$1</mark>')}function j(e,t){return!e||e.length<=t?e:e.substring(0,t).trim()+"..."}function R(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function V(){i.style.display="block"}function m(){i.style.display="none"}function D(e){let t=i.querySelectorAll(".search-result-item"),s=i.querySelector(".search-result-item.active"),r=-1;switch(s&&(r=Array.from(t).indexOf(s)),e.key){case"ArrowDown":e.preventDefault(),r<t.length-1&&(s&&s.classList.remove("active"),t[r+1].classList.add("active"));break;case"ArrowUp":e.preventDefault(),r>0&&(s&&s.classList.remove("active"),t[r-1].classList.add("active"));break;case"Enter":e.preventDefault(),s&&s.click();break;case"Escape":m(),u.blur();break}}})();
